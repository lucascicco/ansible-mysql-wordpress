# ansible-mysql-wordpress

### Introduction

This project is the union of a webserver with a database running in two different virtual machines (created using vagrant, settings are in vagrantFile), but
ansible provisions both with the enviroment variables, ip address, permissions and etc. Summing up, I've two roles: mysql and wordpress, the reason is to "simulate"
a regular web-application on production, then after setting up the machine which runs the database, I set the wordpress to be up running but connected with the database already up.

### How it works

For each virtual machine in vagrantFile you need to set a private network address, it can
be defined using a fixed ip adressed or from dhcp, in this project as I am using virtual box, 
I set up it to a have the network of 172.17.177.0/24. then I just provided two fixed ip addresses to both machines.
 - 172.17.177.40 (wordpress)
 - 172.17.177.42 (mysql)
 
Before running any ansible command, both machines need to be up running in the system, then using vagrant to manage it make it easier than you think. 
in the folder where is located your vagrantFile you can run the vagrant commands, such as: vagrant -> up, ssh, destroy e etc... then, just run "vagrant up" with the
vagrantFile already configured, if your provider is the virtualbox, you can the two machines up running in the window.

Then, now ansiable is almost there to get the control of these two machines running, so creating a new file at root of the project "hosts" is important to set up the
: name of the role, virtual machine's ip you want to get in, then tell ansible the user (usually, "vagrant") of that machine, pointing to the ssh with the private_key (generated by vagrant) will make the process succeed.

Now comes the most interisting part, where ANSIBLE comes in with the power of PROVISIONING multiple machines, you can create a "yml" file that will hold these settings, like: 
provisioning.yml, here comes the play, if you want an organized project, just separate it into roles, so make a folder called "roles", that will follow a standard path:
roles/role_name/${tasks, handlers, defaults, templates, meta}/main.yml, each folder inside the exact role will have specific behaviors. But in the end of the day your provisioning.yml file 
will look something like this:

``` yaml
- hosts: database
  roles:
    - mysql

- hosts: wordpress
  roles:
    - wordpress
```

the folder that holds the enviroment variables for each role is called "group_vars", for the "database" role, it will be like this:

``` yaml
  wp_host_ip: '172.17.177.40'

```

when everything is set up you are finally able to run:

`ansible-playbook -i hosts provisioning.yml`

If everything is right, you should be able to acess 172.17.177.40 and see a wordpress page that is connected with the database hosted at 172.17.177.42.

<hr />

written by,

lucascicco.

